#!/usr/bin/env bash

function doWork() {
    local srcf=~/.config/kitty/current-theme.conf
    if [[ ! -f ${srcf} ]]; then
        echo "Source file ${srcf} doesn't exist"
        exit 1
    fi
    local line name val
    declare -A colors
    while read -r line; do
        ( [[ -z "${line}" ]] || [[ "${line}" =~ ^# ]] ) && continue
        read -r name val <<< "${line}"
        ( [[ -z "${name}" ]] || ! [[ "${val}" =~ ^# ]] ) && continue 
        colors["${name}"]="${val}"
    done < "${srcf}"
    local destf=~/.theme/currentTheme.Xresources
    {
        echo '! vim: filetype=xdefaults:'
        local cnt
        for cnt in {0..15}; do 
            echo "*color${cnt}: ${colors[color${cnt}]}"
        done
        echo "*background: ${colors[background]}"
        echo "*foreground: ${colors[foreground]}"
        echo "*cursorColor: ${colors[cursor]}"
        echo "*highlightColor: ${colors[selection_background]}"
        echo "*highlightTextColor: ${colors[selection_foreground]}"
    } > "${destf}"
    xrdb -override "${destf}"

    destf=~/.theme/nvimThemeColors.lua
    {
        echo 'return {'
        local cnt
        for cnt in {0..15}; do
            echo "color${cnt} = '${colors[color${cnt}]}',"
        done
        echo "background = '${colors[background]}',"
        echo "foreground = '${colors[foreground]}',"
        echo "cursor = '${colors[cursor]}',"
        echo "selectionBackground = '${colors[selection_background]}',"
        echo "selectionForeground = '${colors[selection_foreground]}'"
        echo '}'
    } > "${destf}"

    destf=~/.theme/fzfColors
    {
        echo '#!/bin/zsh'
        echo "export FZF_COLORS=\"fg:0,bg:15,hl:1,fg+:${colors[selection_foreground]},bg+:${colors[selection_background]},hl+:1,info:6,prompt:4,pointer:5,marker:6,spinner:6,header:6\""
    } > "${destf}"

}

doWork $@
